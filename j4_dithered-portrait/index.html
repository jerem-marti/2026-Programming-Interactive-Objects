<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Dithered Portrait — 32×32 Matrix</title>
	<style>
		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
		}

		body {
			font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
			background-color: #1a1a2e;
			color: #e0e0e0;
			padding: 2rem;
			min-height: 100vh;
		}

		h1 {
			font-size: 1.4rem;
			margin-bottom: 0.3rem;
			color: #e94560;
		}

		h1 span {
			color: #555;
			font-weight: 300;
		}

		p.subtitle {
			font-size: 0.85rem;
			color: #888;
			margin-bottom: 1.5rem;
		}

		/* ── Layout ────────────────────────────────────────── */

		.container {
			display: flex;
			gap: 2rem;
			flex-wrap: wrap;
		}

		.panel {
			background: #16213e;
			border-radius: 8px;
			padding: 1.2rem;
			border: 1px solid #0f3460;
		}

		.panel h2 {
			font-size: 0.85rem;
			text-transform: uppercase;
			letter-spacing: 0.08em;
			color: #e94560;
			margin-bottom: 0.8rem;
		}

		/* ── Video & Canvases ──────────────────────────────── */

		.preview-area {
			display: flex;
			gap: 1.5rem;
			align-items: flex-start;
			flex-wrap: wrap;
		}

		.canvas-box {
			text-align: center;
		}

		.canvas-box label {
			display: block;
			font-size: 0.75rem;
			color: #888;
			margin-bottom: 0.3rem;
		}

		video {
			width: 192px;
			height: 192px;
			object-fit: cover;
			border-radius: 4px;
			background: #000;
		}

		video.hidden {
			display: none;
		}

		canvas {
			display: block;
			image-rendering: pixelated;
			background: #000;
			border-radius: 2px;
		}

		#sourceCanvas {
			width: 192px;
			height: 192px;
		}

		#previewCanvas {
			width: 192px;
			height: 192px;
			border: 2px solid #e94560;
		}

		/* ── Buttons ───────────────────────────────────────── */

		.controls {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
			margin-top: 0.8rem;
		}

		button {
			padding: 0.5rem 1rem;
			border: 1px solid #0f3460;
			border-radius: 4px;
			background: #0f3460;
			color: #e0e0e0;
			font-size: 0.85rem;
			cursor: pointer;
			transition: background 0.15s;
		}

		button:hover {
			background: #1a4a8a;
		}

		button:disabled {
			opacity: 0.35;
			cursor: not-allowed;
		}

		button.active {
			background: #e94560;
			border-color: #e94560;
		}

		button.primary {
			background: #e94560;
			border-color: #e94560;
		}

		button.primary:hover {
			background: #d63851;
		}

		/* ── Settings ──────────────────────────────────────── */

		.setting {
			display: flex;
			align-items: center;
			gap: 0.6rem;
			margin-bottom: 0.5rem;
			font-size: 0.85rem;
		}

		.setting label {
			min-width: 90px;
			color: #aaa;
		}

		input[type="range"] {
			flex: 1;
			max-width: 150px;
			accent-color: #e94560;
		}

		input[type="file"] {
			font-size: 0.8rem;
			color: #aaa;
		}

		input[type="file"]::file-selector-button {
			padding: 0.35rem 0.7rem;
			border: 1px solid #0f3460;
			border-radius: 4px;
			background: #0f3460;
			color: #e0e0e0;
			cursor: pointer;
			margin-right: 0.6rem;
		}

		/* ── Log ───────────────────────────────────────────── */

		pre#log {
			font-family: 'Cascadia Code', 'Fira Code', monospace;
			font-size: 0.75rem;
			color: #6a6a8a;
			background: #0d1117;
			border-radius: 4px;
			padding: 0.8rem;
			max-height: 150px;
			overflow-y: auto;
			margin-top: 1rem;
			white-space: pre-wrap;
			word-break: break-all;
		}
	</style>
</head>
<body>

	<h1>Dithered Portrait <span>— 32×32 LED Matrix</span></h1>
	<p class="subtitle">Floyd-Steinberg error diffusion dithering &middot; Web Serial API (Chrome only)</p>

	<div class="container">

		<!-- ── Left panel: Source & Preview ── -->
		<div class="panel">
			<h2>Preview</h2>
			<div class="preview-area">
				<div class="canvas-box">
					<label>Camera / Source</label>
					<video id="video" class="hidden" autoplay playsinline></video>
					<canvas id="sourceCanvas" width="32" height="32"></canvas>
				</div>
				<div class="canvas-box">
					<label>Dithered Output</label>
					<canvas id="previewCanvas" width="32" height="32"></canvas>
				</div>
			</div>

			<div class="controls">
				<button id="btnCamera">Start Camera</button>
				<button id="btnCapture" disabled>Capture</button>
				<button id="btnLive" disabled>Live Mode</button>
			</div>

			<div class="controls">
				<input type="file" id="fileInput" accept="image/*">
			</div>
		</div>

		<!-- ── Right panel: Settings & Serial ── -->
		<div class="panel">
			<h2>Dithering</h2>
			<div class="setting">
				<label for="chkGrayscale">Grayscale</label>
				<input type="checkbox" id="chkGrayscale">
			</div>
			<div class="setting">
				<label for="strength">Strength</label>
				<input type="range" id="strength" min="0" max="1" step="0.05" value="1.0">
				<span id="strengthValue">1</span>
			</div>

			<h2 style="margin-top: 1.2rem;">Serial</h2>
			<div class="controls">
				<button id="btnConnect" class="primary">Connect Serial</button>
				<button id="btnSend">Send to Matrix</button>
			</div>
		</div>

	</div>

	<pre id="log">Ready. Connect serial port, then capture or load an image.</pre>

	<script type="module" src="js/app.js"></script>

</body>
</html>
